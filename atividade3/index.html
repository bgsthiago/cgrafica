<!DOCTYPE html>
<html>

<head>
  <meta charset=utf-8>
  <script src="../js/three.js"></script>
  <script src="../js/Detector.js"></script>
  <script src="../js/OrbitControls.js"></script>
  <script src="../js/loader/OBJLoader.js"></script>
  <script src="../js/loader/MTLLoader.js"></script>
  <title>Atividade III - Computação Gráfica</title>

  <style>
    body {
      overflow: hidden;
      margin: 0;
      padding: 0;
      background: hsl(0, 0%, 10%);
    }

    p {
      margin: 0;
      padding: 0;
    }

    .left,
    .right {
      position: absolute;
      color: #fff;
      font-family: Geneva, sans-serif;
    }

    .left {
      bottom: 1em;
      left: 1em;
      text-align: left;
    }

    .right {
      top: 0;
      right: 0;
      text-align: right;
    }

    a {
      color: #f58231;
    }

    body {
      overflow: hidden;
      margin: 0;
      padding: 0;
      background: hsl(0, 0%, 10%);
    }

    p {
      margin: 0;
      padding: 0;
    }

    .left,
    .right {
      position: absolute;
      color: #fff;
      font-family: Geneva, sans-serif;
    }

    .left {
      bottom: 1em;
      left: 1em;
      text-align: left;
    }

    .right {
      top: 0;
      right: 0;
      text-align: right;
    }

    a {
      color: #f58231;
    }
  </style>

</head>

<body>

  <script>
    if (!Detector.webgl) {
      Detector.addGetWebGLMessage();
    }

    var container;

    var camera, controls, scene, renderer;
    var lighting, ambient, keyLight, fillLight, backLight;

    group = new THREE.Object3D();

    var windowHalfX = window.innerWidth / 2;
    var windowHalfY = window.innerHeight / 2;

    init();
    animate();

    function init() {

      container = document.createElement('div');
      document.body.appendChild(container);

      /* Camera */

      camera = new THREE.PerspectiveCamera(110, window.innerWidth / window.innerHeight, 1, 1000);
      camera.position.z = 4;

      /* Scene */

      scene = new THREE.Scene();
      lighting = false;

      ambient = new THREE.AmbientLight(0xffffff, 1.0);
      scene.add(ambient);

      keyLight = new THREE.DirectionalLight(new THREE.Color('hsl(30, 100%, 75%)'), 1.0);
      keyLight.position.set(-100, 0, 100);

      fillLight = new THREE.DirectionalLight(new THREE.Color('hsl(240, 100%, 75%)'), 0.75);
      fillLight.position.set(100, 0, 100);

      backLight = new THREE.DirectionalLight(0xffffff, 1.0);
      backLight.position.set(100, 0, -100).normalize();

      /* Model */

      // pumpkinseed
      var mtlLoader = new THREE.MTLLoader();
      mtlLoader.setBaseUrl('assets/');
      mtlLoader.setPath('assets/');
      mtlLoader.load('pumpkinseed.mtl', function(materials) {

        materials.preload();

        /*materials.materials.default.map.magFilter = THREE.NearestFilter;
        materials.materials.default.map.minFilter = THREE.LinearFilter;*/

        var objLoader = new THREE.OBJLoader();
        objLoader.setMaterials(materials);
        objLoader.setPath('assets/');
        objLoader.load('pumpkinseed.obj', function(object) {

          object.position.set(0, -2, 0);
          group.add(object);
          //scene.add(object);

        });

      });

      // hezelnut

      mtlLoader.load('hazelnut.mtl', function(materials) {

        materials.preload();

        /*materials.materials.default.map.magFilter = THREE.NearestFilter;
        materials.materials.default.map.minFilter = THREE.LinearFilter;*/

        var objLoader = new THREE.OBJLoader();
        objLoader.setMaterials(materials);
        objLoader.setPath('assets/');
        objLoader.load('hazelnut.obj', function(object) {

          object.position.set(-2, -2, 0);
          group.add(object);
        //  scene.add(object);

        });

      });

      // sunflower
      mtlLoader.load('sunflowerseed.mtl', function(materials) {

        materials.preload();

        /*materials.materials.default.map.magFilter = THREE.NearestFilter;
        materials.materials.default.map.minFilter = THREE.LinearFilter;*/

        var objLoader = new THREE.OBJLoader();
        objLoader.setMaterials(materials);
        objLoader.setPath('assets/');
        objLoader.load('sunflowerseed.obj', function(object) {

          object.position.set(-2, 0, 0);
          group.add(object);
        //  scene.add(object);

        });

      });

      // pistachio
      mtlLoader.load('almondkernel.mtl', function(materials) {

        materials.preload();

        /*materials.materials.default.map.magFilter = THREE.NearestFilter;
        materials.materials.default.map.minFilter = THREE.LinearFilter;*/

        var objLoader = new THREE.OBJLoader();
        objLoader.setMaterials(materials);
        objLoader.setPath('assets/');
        objLoader.load('almondkernel.obj', function(object) {

          group.add(object);
        //  scene.add(object);

        });

      });

      scene.add(group);

      /* Renderer */

      renderer = new THREE.WebGLRenderer();
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setClearColor(new THREE.Color("hsl(0, 0%, 10%)"));

      container.appendChild(renderer.domElement);

      /* Controls */

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.25;
      controls.enableZoom = false;

      /* Events */

      window.addEventListener('resize', onWindowResize, false);
      window.addEventListener('keydown', onKeyboardEvent, false);

    }

    function onWindowResize() {

      windowHalfX = window.innerWidth / 2;
      windowHalfY = window.innerHeight / 2;

      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();

      renderer.setSize(window.innerWidth, window.innerHeight);

    }

    function onKeyboardEvent(e) {

      if (e.code === 'KeyL') {

        camera.rotation.y = camera.rotation.y + 20;
        render();

      }
      if (e.code === 'keyR'){
        camera.rotation.y = camera.rotation.y + 1;
        render();
      }

    }

    function animate() {

      requestAnimationFrame(animate);

      controls.update();

      render();

    }

    function render() {
      renderer.render(scene, camera);
    }
  </script>
</body>

</html>
